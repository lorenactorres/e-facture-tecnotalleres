<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="soap_request_dian">
        <soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:wcf="http://wcf.dian.colombia">
            <soap:Header xmlns:wsa="http://www.w3.org/2005/08/addressing">
                <wsse:Security
                xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"
                xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
                    <wsu:Timestamp>
                        <wsu:Created t-esc="creation_time"/>
                        <wsu:Expires t-esc="expiration_time"/>
                    </wsu:Timestamp>
                    <wsse:BinarySecurityToken
                        EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"
                        ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                        t-att="{'wsu:Id': binary_security_token_id}"
                        t-esc="binary_security_token"/>
                    <ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
                        <ds:SignedInfo>
                            <ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#">
                                <ec:InclusiveNamespaces PrefixList="wsa soap wcf" xmlns:ec="http://www.w3.org/2001/10/xml-exc-c14n#"/>
                            </ds:CanonicalizationMethod>
                            <ds:SignatureMethod Algorithm="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"/>
                            <ds:Reference t-attf-URI="##{wsa_node_id}">
                                <ds:Transforms>
                                    <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#">
                                        <ec:InclusiveNamespaces PrefixList="soap wcf" xmlns:ec="http://www.w3.org/2001/10/xml-exc-c14n#"/>
                                    </ds:Transform>
                                </ds:Transforms>
                                <ds:DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
                                <ds:DigestValue/>
                            </ds:Reference>
                        </ds:SignedInfo>
                        <ds:SignatureValue/>
                        <ds:KeyInfo t-att-Id="key_info_id">
                            <wsse:SecurityTokenReference>
                                <wsse:Reference
                                    t-attf-URI="##{binary_security_token_id}"
                                    ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"/>
                            </wsse:SecurityTokenReference>
                        </ds:KeyInfo>
                     </ds:Signature>
                  </wsse:Security>
                <wsa:Action t-esc="action"/>
                <wsa:To
                    xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
                    t-att="{'wsu:Id': wsa_node_id}" t-translation="off">https://vpfe-hab.dian.gov.co/WcfDianCustomerServices.svc</wsa:To>
            </soap:Header>
            <soap:Body>
                <t t-call="{{soap_body_template}}"/>
           </soap:Body>
        </soap:Envelope>
    </template>

    <template id="send_test_set_async">
        <wcf:SendTestSetAsync xmlns:wcf="http://wcf.dian.colombia">
            <wcf:fileName t-esc="file_name"/>
            <wcf:contentFile t-esc="content_file"/>
            <wcf:testSetId t-esc="test_set_id"/>
        </wcf:SendTestSetAsync>
    </template>

    <template id="send_bill_sync">
        <wcf:SendBillSync xmlns:wcf="http://wcf.dian.colombia">
            <wcf:fileName t-esc="file_name"/>
            <wcf:contentFile t-esc="content_file"/>
        </wcf:SendBillSync>
    </template>

    <template id="get_status_zip">
        <wcf:GetStatusZip xmlns:wcf="http://wcf.dian.colombia">
            <wcf:trackId t-esc="track_id"/>
        </wcf:GetStatusZip>
    </template>

    <template id="get_xml">
        <wcf:GetXmlByDocumentKey xmlns:wcf="http://wcf.dian.colombia">
            <wcf:trackId t-esc="track_id"/>
        </wcf:GetXmlByDocumentKey>
    </template>

    <template id="get_status">
        <wcf:GetStatus xmlns:wcf="http://wcf.dian.colombia">
            <wcf:trackId t-esc="track_id"/>
        </wcf:GetStatus>
    </template>


    <template id="ubl_extension_dian">
        <ext:UBLExtensions xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2" xmlns:ds="http://www.w3.org/2000/09/xmldsig#" xmlns:ext="urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2" xmlns:sts="dummy" xmlns:xades="http://uri.etsi.org/01903/v1.3.2#" t-att="{'xmlns:sts': sts_namespace}">
            <ext:UBLExtension>
                <ext:ExtensionContent>
                    <sts:DianExtensions>
                        <sts:InvoiceControl>
                            <sts:InvoiceAuthorization t-esc="InvoiceAuthorization"/>
                            <sts:AuthorizationPeriod>
                                <cbc:StartDate t-esc="StartDate"/>
                                <cbc:EndDate t-esc="EndDate"/>
                            </sts:AuthorizationPeriod>
                            <sts:AuthorizedInvoices>
                                <sts:Prefix t-esc="Prefix"/>
                                <sts:From t-esc="From"/>
                                <sts:To t-esc="To"/>
                            </sts:AuthorizedInvoices>
                        </sts:InvoiceControl>
                        <sts:InvoiceSource>
                            <cbc:IdentificationCode listAgencyID="6" listAgencyName="United Nations Economic Commission for Europe" listSchemeURI="urn:oasis:names:specification:ubl:codelist:gc:CountryIdentificationCode-2.1">CO</cbc:IdentificationCode>
                        </sts:InvoiceSource>
                        <sts:SoftwareProvider>
                            <sts:ProviderID schemeAgencyID="195" schemeAgencyName="CO, DIAN (Direcci贸n de Impuestos y Aduanas Nacionales)" t-att-schemeID="provider_check_digit" schemeName="31" t-esc="provider_id"/>
                            <sts:SoftwareID schemeAgencyID="195" schemeAgencyName="CO, DIAN (Direcci贸n de Impuestos y Aduanas Nacionales)" t-esc="software_id"/>
                        </sts:SoftwareProvider>
                        <sts:SoftwareSecurityCode schemeAgencyID="195" schemeAgencyName="CO, DIAN (Direcci贸n de Impuestos y Aduanas Nacionales)" t-esc="software_security_code"/>
                        <sts:AuthorizationProvider>
                            <sts:AuthorizationProviderID schemeAgencyID="195" schemeAgencyName="CO, DIAN (Direcci贸n de Impuestos y Aduanas Nacionales)" schemeID="4" schemeName="31">800197268</sts:AuthorizationProviderID>
                        </sts:AuthorizationProvider>
                        <sts:QRCode t-esc="qr_code_val"/>
                    </sts:DianExtensions>
                </ext:ExtensionContent>
            </ext:UBLExtension>
            <ext:UBLExtension>
                <ext:ExtensionContent>
                    <ds:Signature t-att-Id="document_id">
                        <ds:SignedInfo>
                            <ds:CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/>
                            <ds:SignatureMethod Algorithm="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"/>
                            <ds:Reference t-attf-Id="#{document_id}-ref0" URI="">
                                <ds:Transforms>
                                    <ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
                                </ds:Transforms>
                                <ds:DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
                                <ds:DigestValue/>
                            </ds:Reference>
                            <ds:Reference t-attf-URI="##{key_info_id}">
                                <ds:DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
                                <ds:DigestValue/>
                            </ds:Reference>
                            <ds:Reference Type="http://uri.etsi.org/01903#SignedProperties" t-attf-URI="##{document_id}-signedprops">
                                <ds:DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
                                <ds:DigestValue/>
                            </ds:Reference>
                        </ds:SignedInfo>
                        <ds:SignatureValue t-attf-Id="#{document_id}-sigvalue" t-esc="signature_value"/>
                        <ds:KeyInfo t-att-Id="key_info_id">
                            <ds:X509Data>
                                <ds:X509Certificate t-esc="x509_certificate"/>
                            </ds:X509Data>
                        </ds:KeyInfo>
                        <ds:Object>
                            <xades:QualifyingProperties xmlns:xades="http://uri.etsi.org/01903/v1.3.2#" xmlns:xades141="http://uri.etsi.org/01903/v1.4.1#" t-attf-Target="##{document_id}">
                                <xades:SignedProperties t-attf-Id="#{document_id}-signedprops">
                                    <xades:SignedSignatureProperties>
                                        <xades:SigningTime t-esc="signing_time"/>
                                        <xades:SigningCertificate>
                                            <xades:Cert t-foreach="x509_certificates" t-as="cert">
                                                <xades:CertDigest>
                                                    <ds:DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
                                                    <ds:DigestValue t-esc="sigcertif_digest"/>
                                                </xades:CertDigest>
                                                <xades:IssuerSerial>
                                                    <ds:X509IssuerName t-esc="cert['x509_issuer_description']"/>
                                                    <ds:X509SerialNumber t-esc="cert['x509_serial_number']"/>
                                                </xades:IssuerSerial>
                                            </xades:Cert>
                                        </xades:SigningCertificate>
                                        <xades:SignaturePolicyIdentifier>
                                            <xades:SignaturePolicyId>
                                                <xades:SigPolicyId>
                                                    <xades:Identifier>https://facturaelectronica.dian.gov.co/politicadefirma/v2/politicadefirmav2.pdf</xades:Identifier>
                                                    <xades:Description>Politica de firma para facturas electronicas de la Republica de Colombia</xades:Description>
                                                </xades:SigPolicyId>
                                                <xades:SigPolicyHash>
                                                    <ds:DigestMethod Algorithm="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"/>
                                                    <ds:DigestValue >dMoMvtcG5aIzgYo0tIsSQeVJBDnUnfSOfBpxXrmor0Y=</ds:DigestValue>
                                                </xades:SigPolicyHash>
                                            </xades:SignaturePolicyId>
                                        </xades:SignaturePolicyIdentifier>
                                        <xades:SignerRole>
                                            <xades:ClaimedRoles>
                                                <xades:ClaimedRole t-esc="claimed_role"/>
                                            </xades:ClaimedRoles>
                                        </xades:SignerRole>
                                    </xades:SignedSignatureProperties>
                                </xades:SignedProperties>
                            </xades:QualifyingProperties>
                        </ds:Object>
                    </ds:Signature>
                </ext:ExtensionContent>
            </ext:UBLExtension>
        </ext:UBLExtensions>
    </template>
</odoo>